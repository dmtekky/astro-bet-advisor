import{a1 as I,aj as L,r as o,u as O,b as e,j as t,B as w,s as u}from"./main-BDfILoKw.js";import{d as S,C,c as b,a as k,b as B}from"./card-CC9ncavt.js";import{A as R,a as T,b as V}from"./avatar-4oTx7Kiu.js";import{L as p,I as f}from"./label-CIm_XIqf.js";import{A,a as E}from"./alert-Sqq6S7Qg.js";const K=()=>{const{user:a,signOut:U}=I(),{resetPageViews:j}=L(),[i,d]=o.useState(""),[c,m]=o.useState(""),[h,v]=o.useState(""),[g,y]=o.useState(""),[N,x]=o.useState(!1),D=O();o.useEffect(()=>{(async()=>{var s;if(a)try{const{data:l,error:n}=await u.from("profiles").select("*").eq("id",a.id).single();if(n&&n.code!=="PGRST116")throw n;l?(d(l.username||""),m(l.avatar_url||"")):a.user_metadata&&(d(a.user_metadata.name||((s=a.email)==null?void 0:s.split("@")[0])||""),m(a.user_metadata.avatar_url||""))}catch(l){console.error("Error loading profile:",l)}})()},[a]);const P=async()=>{try{j(),await U(),D("/login")}catch(r){console.error("Failed to sign out",r)}},_=async r=>{r.preventDefault(),v(""),y(""),x(!0);try{if(!a)throw new Error("No user found");const s={id:a.id,username:i,avatar_url:c,updated_at:new Date().toISOString()},{error:l}=await u.from("profiles").upsert(s);if(l)throw l;const{error:n}=await u.auth.updateUser({data:{name:i,avatar_url:c}});if(n)throw n;y("Profile updated successfully!")}catch(s){console.error("Error updating profile:",s),v(s.message||"Failed to update profile")}finally{x(!1)}};if(!a)return e("div",{className:"flex items-center justify-center min-h-screen",children:e("p",{children:"Loading..."})});const F=(r,s)=>r?r.split(" ").map(l=>l[0]).join("").toUpperCase():s?s[0].toUpperCase():"U";return e("div",{className:"container mx-auto py-8 px-4 max-w-4xl",children:t("div",{className:"flex flex-col md:flex-row gap-8",children:[e("div",{className:"w-full md:w-1/3",children:t(S,{children:[e(C,{children:t("div",{className:"flex flex-col items-center space-y-4",children:[t(R,{className:"h-24 w-24",children:[e(T,{src:c,alt:i||a.email}),e(V,{children:F(i,a.email)})]}),t("div",{className:"text-center",children:[e("h3",{className:"text-lg font-medium",children:i||a.email}),e("p",{className:"text-sm text-muted-foreground",children:a.email})]})]})}),e(b,{className:"space-y-4",children:e(w,{variant:"outline",className:"w-full",onClick:P,children:"Sign Out"})})]})}),e("div",{className:"w-full md:w-2/3",children:t(S,{children:[t(C,{children:[e(k,{children:"Profile Information"}),e(B,{children:"Update your account's profile information and email address."})]}),e(b,{children:t("form",{onSubmit:_,className:"space-y-6",children:[h&&e(A,{variant:"destructive",children:e(E,{children:h})}),g&&e(A,{children:e(E,{children:g})}),t("div",{className:"space-y-2",children:[e(p,{htmlFor:"email",children:"Email"}),e(f,{id:"email",type:"email",value:a.email||"",disabled:!0})]}),t("div",{className:"space-y-2",children:[e(p,{htmlFor:"displayName",children:"Display Name"}),e(f,{id:"displayName",type:"text",value:i,onChange:r=>d(r.target.value),placeholder:"Enter your name"})]}),t("div",{className:"space-y-2",children:[e(p,{htmlFor:"avatarUrl",children:"Avatar URL"}),e(f,{id:"avatarUrl",type:"url",value:c,onChange:r=>m(r.target.value),placeholder:"https://example.com/avatar.jpg"})]}),e("div",{className:"flex justify-end",children:e(w,{type:"submit",disabled:N,children:N?"Saving...":"Save"})})]})})]})})]})})};export{K as default};
//# sourceMappingURL=Profile-CS12mV0C.js.map
