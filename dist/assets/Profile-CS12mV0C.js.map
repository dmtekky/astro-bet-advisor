{"version":3,"file":"Profile-CS12mV0C.js","sources":["../../src/pages/Profile.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { supabase } from '@/lib/supabase';\nimport { usePageView } from '@/contexts/PageViewContext';\nimport type { Profile, ProfileInsert } from '@/types/profiles';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\n\nconst Profile = () => {\n  const { user, signOut } = useAuth();\n  const { resetPageViews } = usePageView();\n  const [displayName, setDisplayName] = useState('');\n  const [avatarUrl, setAvatarUrl] = useState('');\n  const [error, setError] = useState('');\n  const [success, setSuccess] = useState('');\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const loadProfile = async () => {\n      if (!user) return;\n      \n      try {\n        // Try to get the profile from the profiles table first\n        const { data: profileData, error } = await (supabase as any)\n          .from('profiles')\n          .select('*')\n          .eq('id', user.id)\n          .single();\n\n        if (error && error.code !== 'PGRST116') throw error; // Ignore \"not found\" error\n\n        if (profileData) {\n          setDisplayName(profileData.username || '');\n          setAvatarUrl(profileData.avatar_url || '');\n        } else if (user.user_metadata) {\n          // Fall back to auth user metadata\n          setDisplayName(user.user_metadata.name || user.email?.split('@')[0] || '');\n          setAvatarUrl(user.user_metadata.avatar_url || '');\n        }\n      } catch (error) {\n        console.error('Error loading profile:', error);\n      }\n    };\n\n    loadProfile();\n  }, [user]);\n\n  const handleSignOut = async () => {\n    try {\n      resetPageViews();\n      await signOut();\n      navigate('/login');\n    } catch (error) {\n      console.error('Failed to sign out', error);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setSuccess('');\n    setLoading(true);\n\n    try {\n      if (!user) throw new Error('No user found');\n\n      // Update the user's profile in the public.profiles table\n      const profileData: ProfileInsert = {\n        id: user.id,\n        username: displayName,\n        avatar_url: avatarUrl,\n        updated_at: new Date().toISOString()\n      };\n\n      // Update the profiles table\n      const { error: profileError } = await (supabase as any)\n        .from('profiles')\n        .upsert(profileData);\n\n      if (profileError) throw profileError;\n      \n      // Update the user's metadata in the auth.users table\n      const { error: updateError } = await supabase.auth.updateUser({\n        data: { \n          name: displayName,\n          avatar_url: avatarUrl \n        }\n      });\n\n      if (updateError) throw updateError;\n      \n      setSuccess('Profile updated successfully!');\n    } catch (error: any) {\n      console.error('Error updating profile:', error);\n      setError(error.message || 'Failed to update profile');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!user) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <p>Loading...</p>\n      </div>\n    );\n  }\n\n  const getInitials = (name?: string, email?: string) => {\n    if (name) {\n      return name\n        .split(' ')\n        .map((n) => n[0])\n        .join('')\n        .toUpperCase();\n    }\n    return email ? email[0].toUpperCase() : 'U';\n  };\n\n  return (\n    <div className=\"container mx-auto py-8 px-4 max-w-4xl\">\n      <div className=\"flex flex-col md:flex-row gap-8\">\n        <div className=\"w-full md:w-1/3\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex flex-col items-center space-y-4\">\n                <Avatar className=\"h-24 w-24\">\n                  <AvatarImage src={avatarUrl} alt={displayName || user.email} />\n                  <AvatarFallback>\n                    {getInitials(displayName, user.email)}\n                  </AvatarFallback>\n                </Avatar>\n                <div className=\"text-center\">\n                  <h3 className=\"text-lg font-medium\">\n                    {displayName || user.email}\n                  </h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {user.email}\n                  </p>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <Button variant=\"outline\" className=\"w-full\" onClick={handleSignOut}>\n                Sign Out\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"w-full md:w-2/3\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Profile Information</CardTitle>\n              <CardDescription>\n                Update your account's profile information and email address.\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSubmit} className=\"space-y-6\">\n                {error && (\n                  <Alert variant=\"destructive\">\n                    <AlertDescription>{error}</AlertDescription>\n                  </Alert>\n                )}\n                {success && (\n                  <Alert>\n                    <AlertDescription>{success}</AlertDescription>\n                  </Alert>\n                )}\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"email\">Email</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    value={user.email || ''}\n                    disabled\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"displayName\">Display Name</Label>\n                  <Input\n                    id=\"displayName\"\n                    type=\"text\"\n                    value={displayName}\n                    onChange={(e) => setDisplayName(e.target.value)}\n                    placeholder=\"Enter your name\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"avatarUrl\">Avatar URL</Label>\n                  <Input\n                    id=\"avatarUrl\"\n                    type=\"url\"\n                    value={avatarUrl}\n                    onChange={(e) => setAvatarUrl(e.target.value)}\n                    placeholder=\"https://example.com/avatar.jpg\"\n                  />\n                </div>\n\n                <div className=\"flex justify-end\">\n                  <Button type=\"submit\" disabled={loading}>\n                    {loading ? 'Saving...' : 'Save'}\n                  </Button>\n                </div>\n              </form>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Profile;\n"],"names":["Profile","user","signOut","useAuth","resetPageViews","usePageView","displayName","setDisplayName","useState","avatarUrl","setAvatarUrl","error","setError","success","setSuccess","loading","setLoading","navigate","useNavigate","useEffect","profileData","supabase","_a","handleSignOut","handleSubmit","e","profileError","updateError","jsx","getInitials","name","email","n","jsxs","Card","CardHeader","Avatar","AvatarImage","AvatarFallback","CardContent","Button","CardTitle","CardDescription","Alert","AlertDescription","Label","Input"],"mappings":"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"}